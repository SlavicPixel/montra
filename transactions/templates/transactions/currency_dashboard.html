{% extends "transactions/base.html" %}
{% load static %}

{% block content %}
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
  </div>

  <div class="row g-4">
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title mb-3">Currency calculator</h5>

          <div class="row g-2 align-items-end">
            <div class="col-12 col-md-4">
              <label class="form-label mb-1">Amount</label>
              <input id="cc-amount" type="number" step="0.01" class="form-control" value="100">
            </div>

            <div class="col-6 col-md-4">
              <label class="form-label mb-1">From</label>
              <select id="cc-from" class="form-select"></select>
            </div>

            <div class="col-6 col-md-4">
              <label class="form-label mb-1">To</label>
              <select id="cc-to" class="form-select"></select>
            </div>
          </div>

          <div class="mt-3">
            <div class="alert alert-light border mb-0">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Result</span>
                <span class="fw-bold" id="cc-result">â€”</span>
              </div>
              <div class="text-muted small mt-1" id="cc-hint"></div>
            </div>
          </div>

            <div class="text-muted small mt-2">
            Rates are pulled from
            <a href="https://exchangerate.host" target="_blank" rel="noopener">
                ExchangeRate API
            </a>
            and are updated every 8 hours.
            </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title mb-3">Top currencies vs {{ base }}</h5>

          {% if rows %}
            <table class="table table-striped align-middle mb-0">
              <thead>
                <tr>
                  <th>Currency</th>
                  <th class="text-end">Rate</th>
                </tr>
              </thead>
              <tbody>
                {% for r in rows %}
                <tr>
                  <td>{{ r.currency }}</td>
                  <td class="text-end">{{ r.rate }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <div class="text-muted">No rates available.</div>
          {% endif %}
          {% if updated_at %}
            <div class="text-muted small mt-2">
                Last updated: {{ updated_at|date:"M d, H:i" }} UTC
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {{ rates_dict|json_script:"fx-rates" }}
  {{ currencies|json_script:"fx-currencies" }}
</div>
{% endblock content %}

{% block javascript %}
<script src="{% static "montra/js/currency_rates.js" %}"></script>
{% endblock javascript %}
