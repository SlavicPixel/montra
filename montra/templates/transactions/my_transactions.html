<!DOCTYPE html>
<html>
<head>
    <title>My Transactions</title>
</head>
<body>

<h1>My Transactions</h1>
<a href="{% url 'dashboard' %}">Dashboard</a>
<p>
    <a href="{% url 'transaction-create' %}">Create new transaction</a>
</p>

<input
    type="text"
    id="search-input"
    placeholder="Search category, description or place..."
    style="width: 300px; padding: 5px;"
>

<table border="1" cellpadding="5">
    <thead>
        <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Amount</th>
            <th>Category</th>
            <th>Description</th>
            <th>Place</th>
            <th>Actions</th>
        </tr>
    </thead>

    {% include "transactions/_transactions_table.html" %}
</table>

<script>
let timeout = null;

document.getElementById("search-input").addEventListener("input", function () {
    clearTimeout(timeout);

    const query = this.value;

    timeout = setTimeout(() => {
        fetch(`?q=${encodeURIComponent(query)}`, {
            headers: { "X-Requested-With": "XMLHttpRequest" }
        })
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, "text/html");
            const newBody = doc.querySelector("#transactions-body");
            document.getElementById("transactions-body").innerHTML = newBody.innerHTML;
        });
    }, 300);
});
</script>

</body>
</html>
